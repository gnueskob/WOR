# 메모

## 기획 데이터

- Q&A : https://docs.google.com/spreadsheets/d/1usynExUehjaw7gWuFvIVMUn0KRNqEP-VrDcDtMGIxlM/edit#gid=0
- dataset : https://docs.google.com/spreadsheets/d/12bSNwPvp6o7ach5bYJQcT1rvx6-xl12krhYxsjc-at4/edit#gid=0

## 토큰 검증

- 하이브 uid, 유저 영토 id를 이용하여 JWT 생성
- 클라는 JWT를 HTTP 헤더에 추가하여 요청
- 서버는 JWT 검증시 `user`테이블에 저장된 내용과 일치하는지 검사
- 유저에 대한 영토 정보는 토큰에 포함된 영토 id를 이용해 memcached 접근

## 기획 데이터 - 구글 스프레드 시트

- 다른 테이블의 데이터 참조 시 id, name 전부 parsing
- 다른 시트의 index Vlookup 함수로 참조
- 기준을 사람이 보기 쉬운 문자열 값으로 설정

## 유저 데이터

- 유저 데이터 로딩은 초기 게임 접속시에 한꺼번에 처리
- 각 데이터의 갱신은 서버로 요청과 함께 갱신된 값을 반환받음

## 단위 시간당 자원 생산량

- 유저가 게임에 접속중일 경우 폴링을 통해 단위시간당 자원 업데이트 요청을 보냄
- 클라에서 자원 획득을 확인할 수 있으며 요청이 더이상 가지 않을 경우 게임 종류(혹은 게임 접속 불량)으로 판단
- 다시 게임에 접속할 시 마지막으로 자원 생산 요청을 보냈던 시점을 기준으로 접속 시간 동안의 자원 생산량 계산후 갱신

## 테이블 PK 설정 관련

- 새로운 유저가 들어오고 해당 유저가 자원, 건물등을 지을 때 유저별로 클러스터링 되는것이 좋겠지만  
  유저 ID 순서별로 자원을 발견하거나 건물을 생성하지 않으므로 레코드의 재분배가 매우 심하게 일어날 것

- 재분배의 경우를 해결하기 위해서는 AUTO_INC를 사용하거나, 애초에 유저가 다룰 수 있는 모든 경우를 레코드로 함께 추가시켜 놓는 것
- 자원의 경우는 위의 방안이 가능하나(기획데이터로 고정이기 때문), 건축물의 경우는 유저데이터이므로 불가